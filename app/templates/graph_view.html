{% extends './layout.html' %}
{% block body %}
<h1 class="mt-3">Ruta mas corta</h1>
<div class="card mb-3 bg-secondary-subtle">
    <div class="card-header">
        <h3>Datos iniciales</h3>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-3">

                <div class="input-group mb-4">
                    <span class="input-group-text bg-secondary text-light border border-secondary">
                        <strong>Nro. de nodos:</strong>
                    </span>
                    <input class="form-control form-control-sm border border-secondary" type="number" name="nud_nodes"
                        id="nud_nodes" min="1" max="20" placeholder="0" value="0" required>
                </div>
            </div>
            <div class="col-3">
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#exampleModal">
                    Vista previa
                </button>

                <!-- Modal -->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">Vista previa del grafo</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                ...
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <form action="#" method="POST">
                    <div class="datatable-wrapper datatable-loading no-footer fixed-columns">
                        <div class="datatable-container">
                            <table class="table border border-dark" id="test">
                                <thead>
                                    <th class="text-center text-light bg-dark">n</th>
                                    <th class="text-center text-light bg-dark">Desde</th>
                                    <th class="text-center text-light bg-dark">Hasta</th>
                                    <th class="text-center text-light bg-dark">Costos</th>
                                </thead>
                                <tbody id="tableBody">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
        </div>


    </div>
</div>

{% endblock %}
{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const nudNodesInput = document.getElementById('nud_nodes');
        const tableBody = document.getElementById('tableBody');
        const maxNodes = parseInt(nudNodesInput.getAttribute('max'), 10);

        nudNodesInput.addEventListener('input', function () {
            const numOfNodes = parseInt(nudNodesInput.value, 10);
            if (numOfNodes <= maxNodes) {
                generateRows(numOfNodes);
            }
            else tableBody.innerHTML = '';
        });

        function generateRows(num) {
            tableBody.innerHTML = ''; // Clear existing rows

            for (let i = 1; i <= num; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <th class="text-center text-light bg-dark">${i}</th>
                    <td><input value=${i} type="text" name="desde_${i}" id="desde_${i}" class="text-center form-control form-control-sm"></td>
                    <td>                        
                        <div style="  height: 150px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px;">
                            
                            ${generateCheckboxes(num, i)}
                            
                            
                        </div>
                    </td>
                    <td id="costos_${i}"></td>
                `;
                tableBody.appendChild(row);
            }
        }
    });
    function generateCheckboxes(num, rowIndex) {
        let checkboxesHTML = '';

        for (let i = 1; i <= num; i++) {
            if (i == rowIndex) continue;
            checkboxesHTML += `
                    <div class="form-check">
                        <input class="form-check-input" name="dests_${rowIndex}" type="checkbox" value="dest_${i}" id="checkbox_${rowIndex}_${i}" onchange="updateCheckedOptions(${rowIndex})">
                        <label class="form-check-label" for="checkbox_${rowIndex}_${i}">
                            Node ${i}
                        </label>
                    </div>
                `;
        }

        return checkboxesHTML;
    }
    function updateCheckedOptions(rowIndex) {
        const checkedOptions = collectCheckedCheckboxes(rowIndex);
        const costosElement = document.getElementById(`costos_${rowIndex}`);
        // costosElement.textContent = checkedOptions.join(',');
        costosElement.innerHTML = '';
        let content = '<div class="row row-cols-5">';
        checkedOptions.forEach((item) => {
            content += `
            <div class="col">
                <div class="input-group mb-4">
                    <span class="input-group-text bg-secondary text-light border border-secondary">
                        Costo ${item}:
                    </span>
                    <input class="form-control form-control-sm border border-secondary" type="number" name="costo_${item}"
                         min="1" max="20" step="0.01" placeholder="0" value="0" required>
                </div>
            </div>    
            `;
        })
        content += '</div>';
        costosElement.innerHTML = content;
    }

    function collectCheckedCheckboxes(rowIndex) {
        const checkboxes = document.querySelectorAll(`input[name="costos_${rowIndex}"]:checked`);
        const checkedOptions = Array.from(checkboxes).map((checkbox) => {
            return checkbox.value;
        });

        return checkedOptions;
    }

</script>
{% endblock %}